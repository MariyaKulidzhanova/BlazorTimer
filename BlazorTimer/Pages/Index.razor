@page "/"

@using System.Threading;
@inject IJSRuntime JsRuntime;

<input @bind-value="Count" class="form-control-sm" />

<div class="buttons mt-2">
    <button @onclick=@StartCountdown class="btn btn-dark">@ButtonName</button>
    <button @onclick=@Pause class="btn btn-success">@ButtonName2</button>
    <button @onclick=@Restart class="btn btn-danger">Restart</button>
</div>


@code {
    private int Count { get; set; } = 0;
    private string ButtonName { get; set; } = "Start";
    private string ButtonName2 { get; set; } = "Pause";
    private int IsOnCount { get; set; } = 0;
    Timer timer;

    void StartCountdown()
    {
        timer = new Timer(new TimerCallback(_ =>
        {
            if (Count > 0)
            {
                Count--;

                InvokeAsync(() =>
                {
                    StateHasChanged();
                });
            }
            if (Count == 0)
            {
                JsRuntime.InvokeAsync<bool>("alert", "Timer finished");
                Count = -1;
            }
        }), null, 1000, 1000);

    }

    void Pause()
    {
        IsOnCount++;
        if (IsOnCount % 2 == 0)
        {
            ButtonName2 = "Pause timer";
            StartCountdown();
        }
        else if (IsOnCount % 2 != 0)
        {
            timer.Change(Timeout.Infinite, Timeout.Infinite);
            ButtonName2 = "Continue timer";
        }
    }

    void Restart()
    {
        timer.Change(Timeout.Infinite, Timeout.Infinite);
        Count = 0;
    }

}
